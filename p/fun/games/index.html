<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Justin Swain - Video Games</title>
  <link rel="stylesheet" href="/style/style.css">
  <link rel="icon" href="/images/spacecat.png">
  <style>
    .steam-card {
      text-align: center;
      padding: 40px 20px;
      background: rgba(0,0,0,0.35);
      border-radius: 16px;
      max-width: 600px;
      margin: 30px auto;
      border: 1px solid #333;
    }
    .steam-card img { width: 160px; height: 160px; border-radius: 50%; border: 4px solid var(--space0); box-shadow: 0 0 30px rgba(0,212,255,0.4); }
    .steam-card h2 { margin: 20px 0 8px; font-size: 2.2rem; color: var(--space0); }
    .stats { margin: 25px 0; font-size: 1.3rem; line-height: 1.8; }
    .level { font-size: 3rem; font-weight: bold; color: var(--space1); text-shadow: 0 0 20px var(--space2); }
    .top-games { margin-top: 30px; }
    .top-games h3 { margin: 0 0 15px; color: var(--space0); }
    .top-games ul { list-style: none; padding: 0; }
    .top-games li {
      background: rgba(0,212,255,0.1);
      margin: 8px 0;
      padding: 10px;
      border-radius: 8px;
      border-left: 4px solid var(--space0);
    }
    .loading { text-align: center; padding: 60px; color: #aaa; font-size: 1.4rem; }
  </style>
</head>
<body>

<div id="container">
  <div id="topBar"></div>
  <div id="headerArea">
    <div id="header">
      <a href="/"><img src="/images/spacecat.png" height="120px"></a>
      <a href="/" style="text-decoration: none;"><strong style="font-size: x-large;">justinswain.dev</strong></a>
    </div>
  </div>

  <div id="flex">
    <main>
      <h1>Video Games</h1>
      <div class="box">
        <p>My Steam profile.</p>

        <div id="steam-loading" class="loading">Fetching Steam data...</div>
        <div id="steam-card" class="steam-card" style="display:none"></div>
      </div>
    </main>
    <sideBar id="sideBarPlaceholder"></sideBar>
  </div>
  <footer id="footerPlaceholder"></footer>
</div>

<script>
// CONFIG — CHANGE ONLY THIS
const STEAM_ID  = "76561198799815501";  //
// =====================================
function cleanGameName(name) {
  if (!name) return "Unknown Game";
  return name
    .replace(/\u2122/g, '™')   // ™
    .replace(/\u00AE/g, '®')   // ®
    .replace(/\u00A9/g, '©')   // ©
    .replace(/[\u00C0-\u017F]/g, ch =>     // Fix common Windows-1252 → UTF-8 glitches
      String.fromCharCode(ch.charCodeAt(0) - (ch.charCodeAt(0) > 127 ? 0x80 : 0))
    )
    .replace(/[^\w\s:®©&\-!'’()+,]/g, '') // Remove any remaining garbage
    .trim();
}
async function loadSteamData() {
  const loading = document.getElementById('steam-loading');
  const card = document.getElementById('steam-card');

  // Cache for 24 hours
  const cache = localStorage.getItem('steamFullCache');
  if (cache && Date.now() - JSON.parse(cache).ts < 86400000) {
    render(JSON.parse(cache).data);
    loading.style.display = 'none';
    return;
  }

  try {
    const [profileRes, levelRes, ownedRes] = await Promise.all([
      fetch(`https://steam-proxy.justinswain2.workers.dev/?url=${encodeURIComponent(
        `https://api.steampowered.com/ISteamUser/GetPlayerSummaries/v0002/?steamids=${STEAM_ID}`
      )}`).then(r => r.json()),

      fetch(`https://steam-proxy.justinswain2.workers.dev/?url=${encodeURIComponent(
        `https://api.steampowered.com/IPlayerService/GetSteamLevel/v1/?steamid=${STEAM_ID}`
      )}`).then(r => r.json()),

      fetch(`https://steam-proxy.justinswain2.workers.dev/?url=${encodeURIComponent(
        `https://api.steampowered.com/IPlayerService/GetOwnedGames/v1/?steamid=${STEAM_ID}&include_appinfo=1&include_played_free_games=1`
      )}`).then(r => r.json())
    ]);

    const player = profileRes.response.players[0];
    const level = levelRes.response?.player_level || "??";
    const gamesData = ownedRes.response;

    if (!player || !gamesData) throw new Error("Missing data");

    const totalGames = gamesData.game_count || 0;
    const top5 = gamesData.games
    .filter(g => g.playtime_forever > 60 && g.appid)
    .sort((a,b) => b.playtime_forever - a.playtime_forever)
    .slice(0, 5)
    .map(g => ({
    name: g.name,
    hours: Math.round(g.playtime_forever / 60),
    appid: g.appid,
  }));

    const recent3 = gamesData.games
    .filter(g => g.rtime_last_played > 60 && g.appid)
    .sort((a,b) => b.rtime_last_played - a.rtime_last_played)
    .slice(0, 3)
    .map(g => ({
    name: g.name,
    hours: Math.round(g.playtime_forever / 60),
    appid: g.appid,
  }));

    const data = { player, level, totalGames, top5, recent3};
    localStorage.setItem('steamFullCache', JSON.stringify({ data, ts: Date.now() }));
    render(data);

    loading.style.display = 'none';

  } catch (e) {
    loading.innerHTML = "Steam is resting...";
    console.log("Steam error:", e);
  }

  function render(d) {
    card.innerHTML = `
      <a href="${d.player.profileurl}" target="_blank"><img src="${d.player.avatarfull}" alt="JustinTX"></a>
      <h2>${d.player.personaname}</h2>
      <div class="stats">
        <div class="level">Level ${d.level}</div>
        <div>${d.totalGames} games owned</div>
      </div>

      <div class="top-games">
        <h3>Most Played</h3>
        <div style="margin:20px;">
            ${d.top5.map(g => `
            <div style="text-align:center;background-image:url(https://steamcdn-a.akamaihd.net/steam/apps/${g.appid}/library_hero.jpg);background-size:cover;padding:20px;border-radius:14px;border:1px solid #333;">
                <a href="https://store.steampowered.com/agecheck/app/${g.appid}"><img src="https://steamcdn-a.akamaihd.net/steam/apps/${g.appid}/capsule_616x353.jpg" 
                    alt="${cleanGameName(g.name)}"
                    style="height: auto;border-radius:8px;box-shadow:0 4px 15px rgba(0,212,255,0.4);"></a>
                <p style="margin:15px 0 6px;font-weight:bold;font-size:1.2rem;color:#fff;text-shadow: 0 0 20px var(--space2);">${cleanGameName(g.name)}</p>
                <p style="color:var(--space0);font-size:1.6rem;font-weight:bold;margin:0;">${g.hours}h</p>
            </div>
            <br>
            `).join('')}
        </div>
      </div>
      
      <div class="top-games">
        <h3>Recent Played</h3>
        <div style="margin:20px;">
            ${d.recent3.map(g => `
            <div style="text-align:center;background-image:url(https://steamcdn-a.akamaihd.net/steam/apps/${g.appid}/library_hero.jpg);background-size:cover;padding:20px;border-radius:14px;border:1px solid #333;">
                <a href="https://store.steampowered.com/agecheck/app/${g.appid}"><img src="https://steamcdn-a.akamaihd.net/steam/apps/${g.appid}/capsule_616x353.jpg" 
                    alt="${cleanGameName(g.name)}"
                    style="height: auto;border-radius:8px;box-shadow:0 4px 15px rgba(0,212,255,0.4);"></a>
                <p style="margin:15px 0 6px;font-weight:bold;font-size:1.2rem;color:#fff;text-shadow: 0 0 20px var(--space2);">${cleanGameName(g.name)}</p>
                <p style="color:var(--space0);font-size:1.6rem;font-weight:bold;margin:0;">${g.hours}h</p>
            </div>
            <br>
            `).join('')}
        </div>
      </div>
      <p style="margin-top:30px">
        <a href="${d.player.profileurl}" target="_blank">View my full Steam profile →</a>
      </p>
    `;
    card.style.display = 'block';
  }
}

loadSteamData();

// usual sidebar/footer + prime clock
async function loadComponent(id, path) {
  try { document.getElementById(id).innerHTML = await (await fetch(path)).text(); } catch(e) {}
}
loadComponent("sideBarPlaceholder", "/components/sidebar.html");
loadComponent("footerPlaceholder", "/components/footer.html");

function isPrime(n) { if(n<2)return false; for(let i=2;i*i<=n;i++)if(n%i===0)return false; return true; }
let n = 2;
setInterval(() => { while(!isPrime(n))n++; const el=document.getElementById("prime-number"); if(el)el.textContent=n++; }, 2000);
</script>

</body>
</html>