<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Justin Swain - Two Envelopes Paradox</title>
    <link rel="stylesheet" href="/style/style.css">
    <link rel="icon" href="/images/spacecat.png">
    <style>
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            cursor: pointer; 
            background-color: var(--space3);
        }
        .box #gameArea { text-align: center; }
        .box #stats { text-align: center; }
        .box #settings { text-align: center; }
        #gameArea { margin-top: 20px; }
        #stats { 
            margin-top: 20px; 
            font-size: 1.1em; }
        #settings { margin-top: 20px; }
        select, input { 
            padding: 8px; 
            margin: 5px; 
        }
        #chartContainer { 
            margin-top: 30px; 
            width: 80%; 
            max-width: 1000px; 
            margin-left: auto; 
            margin-right: auto; 
            background-color: var(--space0);
        }
        #strategy {
            background-color: var(--space3);
            border-radius: 4px;
            border: none;
            font: inherit;
            color: inherit;
            cursor: pointer;
        }
        #numGames {
            width: 80px;
            background-color: var(--space3);
            border-radius: 4px;
            border: none;
            font: inherit;
            color: inherit;
            cursor: text;
        }
    </style>
  </head>
  <body>

<div id="container"><div id="topBar">
    <!--<marquee>Welcome!</marquee>-->
</div>
<div id="headerArea">
    <div id="header">
        <a href="/"><img src="/images/spacecat.png" height="120px"></a>
            <a href="/" style="text-decoration: none;"><strong style="font-size: x-large;">justinswain.dev</strong></a>
    </div>
</div>

<div id="flex">

    <main>
        <h1>Toys</h1>
        <div class="box">
            <h1>The Two Envelopes Paradox</h1>
            <p>
                Two envelopes contain money: one has twice as much as the other. You pick one at random. Before opening it, you can switch to the other. Should you switch? Does it matter?
            </p>
            <p>
                This classic "paradox" suggests switching always boosts your expected winnings - but I belive that is <em>false</em>. Let's test it empirically through simulation and see why.
            </p>
        </div>
        <br>
        <div class="box" id="game">
            <h2>Play the Game</h2>
            <p>
                Experiment with strategies: always switch, always stay, or randomize. Run auto-plays to watch convergence. What do you observe?
            </p>
            <div id="gameArea">
                <button onclick="startGame()">Start New Game</button>
                <p id="status">Click "Start New Game" to begin! <br>Or use the Auto-Play button to see the convergence!</p>
                <div id="choices" style="display: none;">
                    <button onclick="chooseEnvelope(1)">Envelope 1</button>
                    <button onclick="chooseEnvelope(2)">Envelope 2</button>
                </div>
                <div id="switchOption" style="display: none;">
                    <p id="switchPrompt"></p>
                    <button onclick="switchEnvelope(true)">Switch</button>
                    <button onclick="switchEnvelope(false)">Keep</button>
                </div>
                <div id="autoPlay" style="margin-top: 20px;">
                    <select id="strategy">
                        <option value="alwaysSwitch">Always Switch</option>
                        <option value="alwaysStay">Always Stay</option>
                        <option value="random">Randomly Choose</option>
                    </select>
                    <button onclick="autoPlay()">Auto-Play</button>
                </div>
            </div>
            <div id="stats">
                <p>Games Played: <span id="gamesPlayed">0</span></p>
                <p>Total Winnings: <span id="totalWinnings">0</span></p>
                <p>Average Winnings: <span id="avgWinnings">0</span></p>
                <p>Expected Value: <span id="expectedRatio">0</span>X</p>
            </div>
            <div id="settings">
                <h3>Settings</h3>
                <label>Auto-Play Games: <input type="number" id="numGames" value="100" min="1" step="1"></label><br>
                <label><input type="checkbox" id="animate" checked> Animate Auto-Play (50ms delay)</label><br>
                <label><input type="checkbox" id="multiLine" checked> Show All Strategies in Chart</label><br>
                <button onclick="reset()">Reset Stats & Chart</button>
            </div>
            <div id="chartContainer">
                <canvas id="convergenceChart"></canvas>
            </div>
        
            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script>
                let envelope1, envelope2, chosenEnvelope, x;
                let gamesPlayed = 0;
                let totalWinnings = 0;
                let totalRatio = 0;
                let strategyStats = {
                    alwaysSwitch: { games: 0, totalRatio: 0, avgRatioData: [] },
                    alwaysStay: { games: 0, totalRatio: 0, avgRatioData: [] },
                    random: { games: 0, totalRatio: 0, avgRatioData: [] }
                };
        
                const ctx = document.getElementById("convergenceChart").getContext("2d");
                const chart = new Chart(ctx, {
                    type: "line",
                    data: {
                        labels: [],
                        datasets: [
                            { label: "Always Switch", data: [], borderColor: "blue", fill: false, tension: 0.1, hidden: false },
                            { label: "Always Stay", data: [], borderColor: "green", fill: false, tension: 0.1, hidden: false },
                            { label: "Randomly Choose", data: [], borderColor: "red", fill: false, tension: 0.1, hidden: false }
                        ]
                    },
                    options: {
                        scales: {
                            y: { beginAtZero: false, suggestedMin: 0, suggestedMax: 3, title: { display: true, text: "Expected Value" } },
                            x: { title: { display: true, text: "Number of Games" } }
                        },
                        plugins: { legend: { display: true } }
                    }
                });
        
                function startGame() {
                    x = Math.floor(Math.random() * 100) + 1;
                    const isEnvelope1Smaller = Math.random() < 0.5;
                    envelope1 = isEnvelope1Smaller ? x : 2 * x;
                    envelope2 = isEnvelope1Smaller ? 2 * x : x;
                    document.getElementById("status").innerText = "Choose an envelope!";
                    document.getElementById("choices").style.display = "block";
                    document.getElementById("switchOption").style.display = "none";
                }
        
                function chooseEnvelope(choice) {
                    chosenEnvelope = (choice === 1) ? envelope1 : envelope2;
                    document.getElementById("status").innerText = `You picked an envelope with $${chosenEnvelope}.`;
                    document.getElementById("choices").style.display = "none";
                    document.getElementById("switchPrompt").innerText = `Switch to the other envelope or keep your $${chosenEnvelope}?`;
                    document.getElementById("switchOption").style.display = "block";
                }
        
                function switchEnvelope(doSwitch) {
                    const finalAmount = doSwitch ? (chosenEnvelope === envelope1 ? envelope2 : envelope1) : chosenEnvelope;
                    const strategy = document.getElementById("strategy").value;
                    gamesPlayed++;
                    totalWinnings += finalAmount;
                    totalRatio += finalAmount / x;
                    updateStatsAndChart(strategy, finalAmount / x);
                    document.getElementById("status").innerText = 
                        `You got $${finalAmount}. X was $${x}. Envelope 1: $${envelope1}, Envelope 2: $${envelope2}.`;
                    document.getElementById("switchOption").style.display = "none";
                }
        
                function updateStatsAndChart(strategy, ratio) {
                    const avgWinnings = (totalWinnings / gamesPlayed).toFixed(2);
                    const expectedRatio = (totalRatio / gamesPlayed).toFixed(2);
                    document.getElementById("gamesPlayed").innerText = gamesPlayed;
                    document.getElementById("totalWinnings").innerText = totalWinnings;
                    document.getElementById("avgWinnings").innerText = avgWinnings;
                    document.getElementById("expectedRatio").innerText = expectedRatio;
        
                    const strat = strategyStats[strategy];
                    strat.games++;
                    strat.totalRatio += ratio;
                    const avgRatio = strat.totalRatio / strat.games;
                    chart.options.scales.y.min = 1.0;
                    chart.options.scales.y.max = 2.0;
                    strat.avgRatioData.push(avgRatio);
        
                    const multiLine = document.getElementById("multiLine").checked;
                    const maxGames = Math.max(
                        strategyStats.alwaysSwitch.games,
                        strategyStats.alwaysStay.games,
                        strategyStats.random.games
                    );
                    chart.data.labels = Array.from({ length: maxGames }, (_, i) => i + 1);
        
                    if (multiLine) {
                        chart.data.datasets[0].data = strategyStats.alwaysSwitch.avgRatioData;
                        chart.data.datasets[1].data = strategyStats.alwaysStay.avgRatioData;
                        chart.data.datasets[2].data = strategyStats.random.avgRatioData;
                    } else {
                        chart.data.datasets.forEach((dataset, index) => {
                            dataset.data = index === chart.data.datasets.findIndex(d => d.label === getStrategyLabel(strategy))
                                ? strat.avgRatioData : [];
                        });
                    }
                    chart.update();
                }
        
                function getStrategyLabel(strategy) {
                    return strategy === "alwaysSwitch" ? "Always Switch" : 
                           strategy === "alwaysStay" ? "Always Stay" : "Randomly Choose";
                }
        
                async function autoPlay() {
                    const strategy = document.getElementById("strategy").value;
                    const numGames = parseInt(document.getElementById("numGames").value);
                    const animate = document.getElementById("animate").checked;
                    document.getElementById("status").innerText = `Running ${numGames} games with "${strategy}" strategy...`;
        
                    for (let i = 0; i < numGames; i++) {
                        x = Math.floor(Math.random() * 100) + 1;
                        const isEnvelope1Smaller = Math.random() < 0.5;
                        envelope1 = isEnvelope1Smaller ? x : 2 * x;
                        envelope2 = isEnvelope1Smaller ? 2 * x : x;
                        chosenEnvelope = Math.random() < 0.5 ? envelope1 : envelope2;
        
                        let doSwitch;
                        if (strategy === "alwaysSwitch") doSwitch = true;
                        else if (strategy === "alwaysStay") doSwitch = false;
                        else doSwitch = Math.random() < 0.5;
        
                        const finalAmount = doSwitch ? (chosenEnvelope === envelope1 ? envelope2 : envelope1) : chosenEnvelope;
                        gamesPlayed++;
                        totalWinnings += finalAmount;
                        totalRatio += finalAmount / x;
                        updateStatsAndChart(strategy, finalAmount / x);
        
                        if (animate) await new Promise(resolve => setTimeout(resolve, 50));
                    }
        
                    document.getElementById("status").innerText = 
                        `Finished ${numGames} games with "${strategy}" strategy.`;
                }
        
                function reset() {
                    gamesPlayed = 0;
                    totalWinnings = 0;
                    totalRatio = 0;
                    strategyStats = {
                        alwaysSwitch: { games: 0, totalRatio: 0, avgRatioData: [] },
                        alwaysStay: { games: 0, totalRatio: 0, avgRatioData: [] },
                        random: { games: 0, totalRatio: 0, avgRatioData: [] }
                    };
                    document.getElementById("gamesPlayed").innerText = "0";
                    document.getElementById("totalWinnings").innerText = "0";
                    document.getElementById("avgWinnings").innerText = "0";
                    document.getElementById("expectedRatio").innerText = "0";
                    chart.data.labels = [];
                    chart.data.datasets.forEach(dataset => dataset.data = []);
                    chart.update();
                    document.getElementById("status").innerText = "Stats and chart reset. Start a new game!";
                }
            </script>
            <p>
                As you play, track the "Expected Value" (your average winnings relative to the smaller amount, X). It always hovers around 1.5X, no matter the strategy. Why?
            </p>    
        </div>
        <br>
        <div class="box">
            <h2>Quick Math Breakdown</h2>
            <p>
                Let X be the smaller amount (random, uniform 1-100 here).
            </p>
            <ul>
                <li><strong>Initial pick</strong>: 50% chance of X, 50% of 2X.</li>
                <li><strong>Always switch</strong>: If you have X, get 2X; if 2X, get X. Expected: 1.5X.</li>
                <li><strong>Always stay</strong>: Opposite, but same expected value: 1.5X.</li>
                <li><strong>Random (50/50)</strong>: Average of above, still 1.5X.</li>
            </ul>
            <p>
                No advantage! The "paradox" stems from faulty logic: assuming the unchosen envelope is equally likely to have half or double your amount leads to E[other] = 1.25 times yours, implying switch. But this double-counts scenarios incorrectly—your amount isn't fixed independently.
            </p>
            <h3>The Fallacy Exposed</h3>
            <p>
                The error treats your envelope's value as known when calculating the other's, but it's not. In reality, no new info is gained, unlike Monty Hall (where the host reveals info). Switching is like repicking randomly <em>with</em> the exact same odds.
            </p>
            <p>
                Play 1,000+ games per strategy. See the lines converge to 1.5? That's the not <em>proof</em>, but is pretty strong <em>evidence</em>.
            </p>
            <p>
                Thoughts? Share your results or counterarguments—I built this because I question the "it doesn't matter" dismissal in unbounded cases, but simulations say otherwise here. Let's debate!
            </p>
        </div>
    </main>
    <sideBar id="sideBarPlaceholder"></sideBar>
</div>
<footer id="footerPlaceholder" style="margin-top: 10px;"></footer>
</div>

<!-- JavaScript to load components -->
<script>
async function loadComponent(elementId, filePath) {
  try {
    const response = await fetch(filePath);
    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status}`);
    }
    const content = await response.text();
    if (!content) {
      console.warn(`File ${filePath} is empty or not loaded`);
    }
    document.getElementById(elementId).innerHTML = content;
  } catch (error) {
    console.error(`Error loading ${filePath}:`, error);
  }
}

// Load the components
loadComponent("sideBarPlaceholder", "/components/sidebar.html");
loadComponent("footerPlaceholder", "/components/footer.html");
function isPrime(n) {
    if (n < 2) return false;
    for (let i = 2; i <= Math.sqrt(n); i++) {
        if (n % i === 0) return false;
    }
    return true;
}

let currentNum = 2;
function updatePrime() {
    while (!isPrime(currentNum)) currentNum++;
    document.getElementById("prime-number").textContent = currentNum;
    currentNum++;
}
setInterval(updatePrime, 2000); // Updates every 2 seconds
updatePrime();
</script>
</div>
</body>
</html>